# Morpho Twin full demo: MHE + NMPC + CBF + Supervision
seed: 42
dt: 0.1
horizon_steps: 20

plant:
  type: linear_scalar
  a_true: 1.02
  b_true: 0.10
  process_noise_std: 0.02
  meas_noise_std: 0.03
  x0: 0.0

estimation:
  type: mhe
  mhe:
    horizon: 20
    noise:
      Q_diag: [0.04]
      R_diag: [0.09]
    parameters:
      mode: static
      theta_init: [1.0, 0.05]
      P_theta_diag: [1.0, 1.0]
    solver:
      backend: casadi
      max_iter: 50
      tol: 1.0e-6
    arrival_cost_scaling: 1.0

control:
  type: nmpc_casadi
  u_min: -2.0
  u_max: 2.0
  nmpc:
    horizon: 20
    Q: [10.0]
    R_u: [0.1]
    lambda_info: 0.01
    solver_backend: casadi
    max_iter: 50
    rti_mode: false

safety:
  type: cbf_qp
  x_min: -1.0
  x_max: 1.0
  alpha: 0.5
  slack_weight: 1000.0
  cbf:
    alpha: 0.5
    slack_weight: 1000.0
    gamma_robust: 1.0

supervision:
  enabled: true
  pe:
    window: 100
    lambda_threshold: 0.1
    condition_threshold: 100.0
  mode:
    uncertainty_normal_to_conservative: 1.0
    uncertainty_conservative_to_safe: 5.0
    uncertainty_safe_to_conservative: 3.0
    uncertainty_conservative_to_normal: 0.5
    pe_violation_count_conservative: 10
    pe_violation_count_safe: 50
    pe_satisfaction_count_recovery: 20
    margin_factor_normal: 1.0
    margin_factor_conservative: 2.0
    margin_factor_safe: 5.0

scenario:
  steps: 500
  reference:
    type: step
    t_step: 5.0
    value: 0.8
